<html>

<!-- ################################################################################################
###    Actuarial Exams: The Game (April 7, 2014)                        													###
###    																	                       																		###
###    How many attempts will it take you to get to FSA?																					###
###    																	                       																		###
##################################################################################################### -->

<!-- reactjs.org shadow DOM -->
<!-- Backbone comes with a basic push state router, and model object, collection, manages models, hooks in well with -->
<title>Get in the Game</title>
<head>

	<script type="text/javascript" src="js/jquery-1.10.2.js"></script>
	<script src='js/underscore-min.js'></script>
	<link rel="stylesheet" href="css/actuarial.css" type="text/css"/>

	<link rel="shortcut icon" href="images/favicon.png" type="image/x-icon"/>
	<div class = "nav">
		<h1 class="title">Actuarial Exams: The Game</h1>
		<div class="result"></div>
	</div>
</head>

<body>

<div class="game">
	<script>

// #####################################################################################################
//		This script is from the web, used to get the name of the Javascript Object. Great for debugging.
// #####################################################################################################
		Object.prototype.getName = function() {
		  var funcNameRegex = /function (.{1,})\(/;
		  var results = (funcNameRegex).exec((this).constructor.toString());
		  return (results && results.length > 1) ? results[1] : "";
		};

		$(function() {
	    $( "#sortable" ).sortable();
	    $( "#sortable" ).disableSelection();
	  });

		function average(scores){
			sum = 0;
			for(var x = 0; x < scores.length; x ++){
			  sum = sum + scores[x];  //or Sum += scores[x];
			};
			return Math.round(sum*1000/scores.length)/1000;  //length of the array scores is in scores.length
		}

		function product(scores){
			result = 1;
			for(i=0; i<scores.length; i++){
				result = result * scores[i];
			};
			return Math.round(result*100000)/100000;
		}
		function to_upper(string){
		    return string.charAt(0).toUpperCase() + string.slice(1);
		};

		function cleanArray(actual){
		  var newArray = new Array();
		  for(var i = 0; i<actual.length; i++){
		      if (actual[i]){
		        newArray.push(actual[i]);
		    }
		  }
		  return newArray;
		}

// #####################################################################################################
//		SOA Preliminary Exam Data (www.soa.org)
// #####################################################################################################

		var exams = {
			"P"		: {	"name"			: "Probability",
								"completed" : false,
								"sittings"	: 6,
								"hours"			: 3,
								"dates"			: ["January", "March", "May", "July", "September", "November"],
								"passrates"	: [.486, .423, .419, .426]},
			"FM"	: {	"name"			: "Financial Mathematics",
								"completed" : false,
								"sittings"	: 6,
								"hours"			: 3,
								"dates"			: ["February", "April", "June", "August", "October", "December"],
								"passrates"	: [.427, .416, .464, .458]},
			"MFE"	: {	"name"			: "Financial Economics",
								"completed" : false,
								"sittings"	: 3, "hours": 3,
								"dates"			: ["March", "July", "November"],
								"passrates"	: [.422, .495, .526]},
			"MLC"	: {	"name"			: "Life Contingencies",
								"completed" : false,
							  "sittings"	: 2,
								"hours"			: 4,
								"dates"			: ["April", "October"],
								"passrates"	: [.406, .416]},
			"C"		: {	"name"			: "Actuarial Models",
								"completed" : true,
								"sittings"	: 3,
								"hours"			: 3.5,
								"dates"			: ["February", "June", "October"],
								"passrates"	: [.442, .398]},
			"fap1": {	"name"			: "FAP1",
								"completed" : false,
								"sittings"	: 12,
								"hours"			: 720,
								"dates"			: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
								"passrates"	: [.75]},
			"fap2": {	"name"			: "FAP2",
								"completed" : false,
								"sittings"	: 12,
								"hours"			: 96,
								"dates"			: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
								"passrates"	: [.7]},
		};

		//Update exams hash to include passrate; the mean of passrates
		_.map(exams, function(exam){ exam.passrate = average(exam.passrates);});

		var completedExams = cleanArray(_.map(exams, function(exam){ if(exam.completed == true){return exam.name};}));
		var outstandingExams = cleanArray(_.map(exams, function(exam){ if(exam.completed == false){return exam.name};}));

		function update(exams){
				completedExams = cleanArray(_.map(exams, function(exam){ if(exam.completed == true){return exam.name};}));
				outstandingExams = cleanArray(_.map(exams, function(exam){ if(exam.completed == false){return exam.name};}));
		}

		// var passrates = cleanArray(_.map(exams, function(exam){ if(exam.completed == false){return exam.passrate};}));

// #####################################################################################################
//		User Profile
// #####################################################################################################

		var user = {
			"first_name" 	: "Bob",
			"last_name" 	: "Smith",
			"school" 			: "U of M",
			"degree" 			: "Bachelors of Actuarial Science",
			"outstanding"	: ["P", "FM", "MFE", "MLC", "C", "fap1", "fap2"]
		};

// #####################################################################################################
//		Define Methods
// #####################################################################################################
		function total(scores){
			sum = 0;
			for(var x = 0; x < scores.length; x ++){
			  sum = sum + scores[x];  //or Sum += scores[x];
			};
			return Math.round(sum*1000)/1000;  //length of the array scores is in scores.length
		}

		function draw(item, tag, newLine){
			newLine = newLine || false;
			tag = tag || "span";
			if (newLine == false){
				newLine = "";
			}
			else{
				newLine = "<br>";
			}
			opentag = "<" + tag + ">"
			closetag = "</" + tag + ">"
			document.writeln(opentag + item + newLine + closetag);
		}

		function dice(){
			return _.random(0, Math.pow(10,3))/Math.pow(10,3);
		}

		var attempts = 0;
		var success = 0;
		var travelTime = 0;
		var data = [];

		function simulation(exams){
			var i = 0;
			while (success < exams.length){
				if (dice() < exams[i].passrate){
					document.writeln("You Passed " + exams[i].name + "<br>");
					exams[i].completed = true;
					success++;
					attempts++;
					travelTime +=
					i++;
				}else{
					document.writeln("You Failed " + exams[i].name + "<br>");
					attempts++;
				}
			}
			return exams;
		}

		function results(exams){
			var passrates = cleanArray(_.map(exams, function(exam){ if(exam.completed == false){return exam.passrate};}));
			var timeRemaining = total(cleanArray(_.map(exams, function(exam){ if(exam.completed == false){return exam.hours};})));

			document.write("<div class='results'>");
			draw("Status: ", "b");
			draw("You have " + outstandingExams.length + " exams left to go, totaling " + timeRemaining + " hrs.", "span", "break");
			draw("Coming up: ", "b");
			draw(outstandingExams[0], "span", "break");
			draw("Likelihood: ", "b");
			draw(passrates[0], "span", "break");
			document.write("<div style='height: 5px; border-top: 1px dashed black'></div>")
			draw("Completed: ", "b");
			draw(completedExams, "span", "break");
			draw("Outstanding: ", "b");
			draw(outstandingExams, "span", "break");
			document.write("</div>");
		};

		// stats.prototype = new results();

		function stats(exams){
			document.write("<div class='stats'>");
			simulation(exams);
			document.write("</div>");
		};

		function exam_details(exam){
			document.write("<li class='exam'>");
			draw(exam.name, "u", "break");
			draw("Time: ") + draw(exam.hours,"span") + draw(" hrs", "span", "break");
			draw("Sittings: ") + draw(exam.sittings + "/year","span", "break");
			draw("Dates: ") + draw(exam.dates,"span", "break");
			draw("Pass Rate: ") + draw(exam.passrate, "span", "break");

			draw("Completed: ") + draw(to_upper(String(exam.completed)), "span", "break");
			draw("Sitting", "button", "break");
			document.write("</li>" + "<br>");
		};

// #####################################################################################################
//		Declare Variables
// #####################################################################################################

		var examP = exams.P;
		var examFM = exams.FM;
		var examMFE = exams.MFE;
		var examMLC = exams.MLC;
		var examC = exams.C;
		var fap1 = exams.fap1;
		var fap2 = exams.fap2;
		var preliminary = [examP, examFM, examMFE, examMLC, examC, fap1, fap2];
		// var modules = [fap1, fap2];
		// var fsaExams = []

// #####################################################################################################
//		Initialize Data
// #####################################################################################################

		_.map(exams, function(exam){ exam.passrate = average(exam.passrates)})

// #####################################################################################################
//		Test the code
// #####################################################################################################

		user["exams"] = preliminary;
		draw("Results", "h2");
		stats(user.exams);
		results(user.exams);
		document.write("<h2>Preliminary Exams</h2>");
		document.write("<ul id='sortable' style='padding: 0;'>");
		_.each(user.exams, exam_details);
		document.write("</ul>");

	</script>
</div>
</body>
</html>